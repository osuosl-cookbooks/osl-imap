# This file was generated by Chef Infra
# Do NOT modify this file by hand.
auth_mechanisms = <%= @auth_mechanisms %>
auth_username_format = <%= @auth_username_format %>
mail_location = <%= @mail_location %>
mbox_write_locks = <%= @mbox_write_locks %>
<% unless @passdb.empty? -%>

passdb {
<% @passdb.each do |db| -%>
  <%= db %>
<% end -%>
}
<% end -%>
<% unless @userdb.empty? -%>

userdb {
<% @userdb.each do |db| -%>
  <%= db %>
<% end -%>
}
<% end -%>
<% if @auth_type == 'system' -%>

<% if @passdb.empty? -%>
passdb {
  args = dovecot
  driver = pam
}
<% end -%>
<% if @userdb.empty? -%>
userdb {
  driver = passwd
}
<% end -%>
<% elsif @auth_type == 'mysql' -%>

<% if @passdb.empty? -%>
passdb {
  args = /etc/dovecot/dovecot-sql.conf.ext
  driver = sql
}
<% end -%>
<% if @userdb.empty? -%>
userdb {
  args = /etc/dovecot/dovecot-sql.conf.ext
  driver = sql
}
<% end -%>
<% elsif @auth_type == 'ldap' -%>

<% if @passdb.empty? -%>
passdb {
  args = /etc/dovecot/dovecot-ldap.conf.ext
  driver = ldap
}
<% end -%>
<% if @userdb.empty? -%>
userdb {
  args = /etc/dovecot/dovecot-ldap.conf.ext
  driver = ldap
}
<% end -%>
<% end -%>

protocols = <%= @protocols %>
service auth {
  unix_listener /var/spool/postfix/private/auth {
    group = postfix
    mode = 0660
    user = postfix
  }
}
<% if @protocols.match?('lmtp') -%>
service lmtp {
  unix_listener /var/spool/postfix/private/dovecot-lmtp {
    group = postfix
    mode = 0600
    user = postfix
  }
}
<% end -%>
service imap-login {
  inet_listener imap {
    port = 0
  }
}
service pop3-login {
  inet_listener pop3 {
    port = 0
  }
}
ssl = required
ssl_cert = <<%= @ssl_cert %>
ssl_cipher_list = ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA:ECDHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES256-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:!DES-CBC3-SHA:!DSS
ssl_key = <<%= @ssl_key %>
ssl_options = no_compression no_ticket
ssl_prefer_server_ciphers = yes
<% if !@extra_options.empty? -%>

# Extra options
<% end -%>
<% @extra_options.each do |opt| -%>
<%= opt %>
<% end -%>
